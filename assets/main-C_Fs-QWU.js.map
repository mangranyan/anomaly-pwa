{"version":3,"mappings":"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","names":["currentParams","routes","renderHome","bindHomeEvents","renderQRGen","bindQRGenEvents","renderMQTTConfig","bindMQTTConfigEvents","renderForm","bindFormEvents","navigate","path","route","appEl","bottomNav","initApp","getDraft","deleteDraft","__vitePreload","draft","isDevice","escapeHtml","startScan","text","parseQrText","params","currentType","renderFields","container","product","line","station","query","bgColor","deviceName","assetCode","generateQRCanvas","canvas","blob","a","getConfig","config","hostUrl","username","password","clientId","client","resolve","reject","e","err","msg","_a","saveConfig","reporter","desc","data","_b","m"],"ignoreList":[],"sources":["../../app.js"],"sourcesContent":["// app.js\r\nimport './style.css';\r\n\r\nlet currentParams = null;\r\n\r\nconst routes = {\r\n  '/': { render: renderHome, bindEvents: bindHomeEvents },\r\n  '/qr-gen': { render: renderQRGen, bindEvents: bindQRGenEvents },\r\n  '/mqtt-config': { render: renderMQTTConfig, bindEvents: bindMQTTConfigEvents },\r\n  '/form': { render: renderForm, bindEvents: bindFormEvents }\r\n};\r\n\r\nfunction navigate() {\r\n  const path = location.hash.slice(1) || '/';\r\n\r\n  if (path === '/form' && !currentParams) {\r\n    location.hash = '/';\r\n    return;\r\n  }\r\n\r\n  const route = routes[path] || routes['/'];\r\n\r\n  // Ê∏≤Êüì HTML\r\n  const appEl = document.getElementById('app');\r\n  if (!appEl) {\r\n    console.error('‚ùå #app ÂÖÉÁ¥†Êú™ÊâæÂà∞ÔºåËØ∑Á°Æ‰øù script Âú® DOM Âä†ËΩΩÂêéÊâßË°å');\r\n    return;\r\n  }\r\n  appEl.innerHTML = route.render();\r\n\r\n  // ÁªëÂÆö‰∫ã‰ª∂\r\n  if (typeof route.bindEvents === 'function') {\r\n    route.bindEvents();\r\n  }\r\n\r\n  // ÊéßÂà∂Â∫ïÈÉ®ÂØºËà™ÊòæÁ§∫\r\n  const bottomNav = document.getElementById('bottom-nav');\r\n  if (bottomNav) {\r\n    bottomNav.classList.toggle('hidden', path === '/form');\r\n  }\r\n}\r\n\r\n// ÂàùÂßãÂåñÂ∫îÁî®\r\nfunction initApp() {\r\n  window.addEventListener('hashchange', navigate);\r\n  navigate();\r\n}\r\n\r\n// Á≠âÂæÖ DOM Âä†ËΩΩÂÆåÊàêÂÜçÂêØÂä®Â∫îÁî®\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initApp);\r\n} else {\r\n  // DOM Â∑≤ÁªèÂä†ËΩΩÂÆåÊàê\r\n  initApp();\r\n}\r\n\r\n// ======================\r\n// È°µÈù¢Ê∏≤ÊüìÂáΩÊï∞ÔºàÂè™ËøîÂõû HTML Â≠óÁ¨¶‰∏≤Ôºâ\r\n// ======================\r\n\r\nfunction renderHome() {\r\n  return `\r\n    <div class=\"p-6 pt-12 max-w-md mx-auto\">\r\n      <h1 class=\"text-2xl font-bold text-primary mb-10 text-center\">ÂºÇÂ∏∏ÊèêÊä•</h1>\r\n      <button id=\"scan-btn\" class=\"w-full h-16 bg-primary text-white rounded-xl text-lg font-bold shadow-md active:bg-[#1D4ED8] transform active:scale-95 transition flex items-center justify-center gap-3\">\r\n        Êâ´Á†ÅÊèêÊä•ÂºÇÂ∏∏\r\n      </button>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderQRGen() {\r\n  return `\r\n    <div class=\"p-4 pt-6 max-w-md mx-auto\">\r\n      <h2 class=\"text-xl font-bold mb-4 text-center\">ÁîüÊàêÂºÇÂ∏∏‰∫åÁª¥Á†Å</h2>\r\n      <div class=\"flex mb-6 rounded-lg overflow-hidden border\">\r\n        <button id=\"tab-device\" class=\"flex-1 py-3 bg-blue-100 text-primary font-medium\">ËÆæÂ§áÂºÇÂ∏∏</button>\r\n        <button id=\"tab-process\" class=\"flex-1 py-3 bg-gray-100 text-gray-600 font-medium\">Âà∂Á®ãÂºÇÂ∏∏</button>\r\n      </div>\r\n      <div id=\"form-fields\" class=\"space-y-4 mb-8\"></div>\r\n      <button id=\"gen-btn\" class=\"w-full h-14 bg-primary text-white rounded-xl font-bold mb-6\">ÁîüÊàê‰∫åÁª¥Á†Å</button>\r\n      <div id=\"qr-output\" class=\"hidden flex flex-col items-center\">\r\n        <div id=\"qr-canvas-container\" class=\"w-64 h-64 mb-4 flex items-center justify-center\"></div>\r\n        <button id=\"download-btn\" class=\"border border-primary text-primary px-6 py-2 rounded-lg font-medium\">‰∏ãËΩΩ PNG</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderMQTTConfig() {\r\n  return `\r\n    <div class=\"p-4 pt-6 max-w-md mx-auto\">\r\n      <h2 class=\"text-xl font-bold mb-6 text-center\">MQTT ÈÖçÁΩÆ</h2>\r\n      <div id=\"password-prompt\" class=\"mb-6\">\r\n        <label class=\"block text-gray-700 mb-2\">ËØ∑ËæìÂÖ•ÂØÜÁ†Å</label>\r\n        <input type=\"password\" id=\"config-pwd\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg mb-4\" placeholder=\"ËØ∑ËæìÂÖ•ÂØÜÁ†Å\">\r\n        <button id=\"unlock-btn\" class=\"w-full h-12 bg-secondary text-white rounded-lg font-medium\">Á°ÆËÆ§</button>\r\n      </div>\r\n      <div id=\"config-form\" class=\"hidden space-y-4\">\r\n        <div><label class=\"block text-gray-700 mb-1\">ÁõÆÊ†áÂú∞ÂùÄÔºàWebSocket URLÔºâ</label>\r\n        <input type=\"text\" id=\"host-url\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" value=\"wss://mqtt-broker.shokz.com.cn:8084/mqtt\"></div>\r\n        <div><label class=\"block text-gray-700 mb-1\">Áî®Êà∑Âêç</label>\r\n        <input type=\"text\" id=\"username\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" value=\"Ml3rqYX5cPN\"></div>\r\n        <div><label class=\"block text-gray-700 mb-1\">ÂØÜÁ†Å</label>\r\n        <input type=\"password\" id=\"password\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" value=\"6jKFfGiqxjj\"></div>\r\n        <div><label class=\"block text-gray-700 mb-1\">Client ID</label>\r\n        <input type=\"text\" id=\"clientId\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" value=\"Ml3rqYX5cPN\"></div>\r\n        <div><label class=\"block text-gray-700 mb-1\">‰∏äÊä• Topic</label>\r\n        <input type=\"text\" id=\"topic\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" value=\"v4/p/post/thing/live/json/1.1\"></div>\r\n        <button id=\"test-btn\" class=\"w-full h-12 bg-primary text-white rounded-lg font-medium mt-2\">ËÅîÈÄöÊµãËØï</button>\r\n        <button id=\"save-btn\" class=\"w-full h-12 bg-gray-700 text-white rounded-lg font-medium mt-2\">‰øùÂ≠òÈÖçÁΩÆ</button>\r\n      </div>\r\n      <div class=\"text-xs text-gray-500 mt-8 pt-4 border-t\">Êú¨Â∫îÁî®‰ªÖÁî®‰∫éÂÜÖÈÉ®ÂºÇÂ∏∏ÊèêÊä•Ôºå‰∏çÊî∂ÈõÜ‰∏™‰∫∫Ë∫´‰ªΩ‰ø°ÊÅØ„ÄÇ</div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nasync function renderForm() {\r\n  const { getDraft, deleteDraft } = await import('./db.js');\r\n  let draft = await getDraft();\r\n  if (draft?.formData) {\r\n    if (confirm('Ê£ÄÊµãÂà∞Êú™Êèê‰∫§ËçâÁ®øÔºåÊòØÂê¶ÊÅ¢Â§çÔºü')) {\r\n      currentParams = { ...currentParams, ...draft.formData };\r\n    } else {\r\n      await deleteDraft();\r\n    }\r\n  }\r\n\r\n  const isDevice = currentParams.type === 'ËÆæÂ§áÁ±ªÂºÇÂ∏∏';\r\n  const { escapeHtml } = await import('./utils.js');\r\n\r\n  return `\r\n    <div class=\"p-4 pt-6 max-w-md mx-auto\">\r\n      <h2 class=\"text-xl font-bold mb-4 text-center\">ÂºÇÂ∏∏ÊèêÊä•</h2>\r\n      <div class=\"bg-gray-50 rounded-xl p-4 mb-5 space-y-3\">\r\n        <div><span class=\"text-gray-500 text-sm\">‰∫ßÂìÅ</span><div class=\"font-medium\">${escapeHtml(currentParams.product)}</div></div>\r\n        <div><span class=\"text-gray-500 text-sm\">‰∫ßÁ∫ø</span><div class=\"font-medium\">${escapeHtml(currentParams.line)}</div></div>\r\n        <div><span class=\"text-gray-500 text-sm\">Â∑•Á´ô</span><div class=\"font-medium\">${escapeHtml(currentParams.station)}</div></div>\r\n        <div><span class=\"text-gray-500 text-sm\">ÂºÇÂ∏∏Á±ªÂûã</span><div class=\"font-medium\">${escapeHtml(currentParams.type)}</div></div>\r\n        ${isDevice ? `\r\n          <div><span class=\"text-gray-500 text-sm\">ËÆæÂ§áÂêçÁß∞</span><div class=\"font-medium\">${escapeHtml(currentParams.deviceName || 'N/A')}</div></div>\r\n          <div><span class=\"text-gray-500 text-sm\">ËµÑ‰∫ßÁºñÁ†Å</span><div class=\"font-medium\">${escapeHtml(currentParams.assetCode || 'N/A')}</div></div>\r\n        ` : ''}\r\n      </div>\r\n      <div class=\"space-y-4\">\r\n        <div><label class=\"block text-gray-700 mb-1\">ÊèêÊä•‰∫∫ <span class=\"text-red-500\">*</span></label>\r\n        <input type=\"text\" id=\"reporter\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg text-base\" placeholder=\"ËØ∑ËæìÂÖ•ÂßìÂêç\" required></div>\r\n        <div><label class=\"block text-gray-700 mb-1\">ÂºÇÂ∏∏ÊèèËø∞ <span class=\"text-red-500\">*</span></label>\r\n        <textarea id=\"desc\" class=\"w-full h-24 px-4 py-2 border border-gray-300 rounded-lg text-base\" placeholder=\"ËØ∑ËØ¶ÁªÜÊèèËø∞ÂºÇÂ∏∏Áé∞Ë±°\" required></textarea></div>\r\n        ${!isDevice ? `\r\n          <div><label class=\"block text-gray-700 mb-1\">ËâØÁéáÔºàÂ¶ÇÔºö95%Ôºâ</label>\r\n          <input type=\"text\" id=\"yield\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg text-base\" placeholder=\"‰æãÔºö95%\"></div>\r\n          <div><label class=\"block text-gray-700 mb-1\">‰∏¥Êó∂Â§ÑÁΩÆÊé™ÊñΩ</label>\r\n          <textarea id=\"measure\" class=\"w-full h-20 px-4 py-2 border border-gray-300 rounded-lg text-base\" placeholder=\"‰æãÔºöÊöÇÂÅúËØ•Â∑•‰Ωç‰Ωú‰∏ö\"></textarea></div>\r\n        ` : ''}\r\n        <button id=\"submit-btn\" class=\"w-full h-14 bg-primary text-white rounded-xl font-bold text-lg mt-2\">Êèê‰∫§</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n// ======================\r\n// ‰∫ã‰ª∂ÁªëÂÆöÂáΩÊï∞\r\n// ======================\r\n\r\nasync function bindHomeEvents() {\r\n  document.getElementById('scan-btn').onclick = async () => {\r\n    const { startScan } = await import('./scanner.js');\r\n    startScan(async (text) => {\r\n      const { parseQrText } = await import('./utils.js');\r\n      const params = parseQrText(text);\r\n      if (!params || !params.product || !params.line || !params.station || !params.type) {\r\n        alert('‰∫åÁª¥Á†ÅÊ†ºÂºèÈîôËØØÔºöÁº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞');\r\n        return;\r\n      }\r\n      window.currentParams = params;\r\n      location.hash = '/form';\r\n    });\r\n  };\r\n}\r\n\r\nfunction bindQRGenEvents() {\r\n  let currentType = 'device';\r\n\r\n  function renderFields() {\r\n    const container = document.getElementById('form-fields');\r\n    container.innerHTML = `\r\n      <div><label class=\"block text-gray-700 mb-1\">‰∫ßÂìÅ</label>\r\n      <input type=\"text\" id=\"product\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" placeholder=\"‰æãÔºöTWSËÄ≥Êú∫\"></div>\r\n      <div><label class=\"block text-gray-700 mb-1\">Á∫øÂà´</label>\r\n      <input type=\"text\" id=\"line\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" placeholder=\"‰æãÔºöSMT-01\"></div>\r\n      <div><label class=\"block text-gray-700 mb-1\">Â∑•Á´ô</label>\r\n      <input type=\"text\" id=\"station\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" placeholder=\"‰æãÔºöAOIÊ£ÄÊµã\"></div>\r\n      ${currentType === 'device' ? `\r\n        <div><label class=\"block text-gray-700 mb-1\">ËÆæÂ§áÂêçÁß∞</label>\r\n        <input type=\"text\" id=\"deviceName\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" placeholder=\"‰æãÔºöÂõûÊµÅÁÑäÊú∫\"></div>\r\n        <div><label class=\"block text-gray-700 mb-1\">ËÆæÂ§áËµÑ‰∫ßÁºñÁ†Å</label>\r\n        <input type=\"text\" id=\"assetCode\" class=\"w-full h-14 px-4 border border-gray-300 rounded-lg\" placeholder=\"‰æãÔºöRFH-2025\"></div>\r\n      ` : ''}\r\n    `;\r\n  }\r\n\r\n  document.getElementById('tab-device').onclick = () => {\r\n    currentType = 'device';\r\n    document.getElementById('tab-device').className = 'flex-1 py-3 bg-blue-100 text-primary font-medium';\r\n    document.getElementById('tab-process').className = 'flex-1 py-3 bg-gray-100 text-gray-600 font-medium';\r\n    renderFields();\r\n  };\r\n\r\n  document.getElementById('tab-process').onclick = () => {\r\n    currentType = 'process';\r\n    document.getElementById('tab-process').className = 'flex-1 py-3 bg-blue-100 text-primary font-medium';\r\n    document.getElementById('tab-device').className = 'flex-1 py-3 bg-gray-100 text-gray-600 font-medium';\r\n    renderFields();\r\n  };\r\n\r\n  renderFields();\r\n\r\n  document.getElementById('gen-btn').onclick = async () => {\r\n    const product = document.getElementById('product').value.trim();\r\n    const line = document.getElementById('line').value.trim();\r\n    const station = document.getElementById('station').value.trim();\r\n    if (!product || !line || !station) {\r\n      alert('ËØ∑Â°´ÂÜô‰∫ßÂìÅ„ÄÅÁ∫øÂà´„ÄÅÂ∑•Á´ô');\r\n      return;\r\n    }\r\n\r\n    let query = `?product=${encodeURIComponent(product)}&line=${encodeURIComponent(line)}&station=${encodeURIComponent(station)}`;\r\n    let bgColor = '#E8F5E9';\r\n\r\n    if (currentType === 'device') {\r\n      const deviceName = document.getElementById('deviceName').value.trim();\r\n      const assetCode = document.getElementById('assetCode').value.trim();\r\n      if (!deviceName || !assetCode) {\r\n        alert('ËÆæÂ§áÂºÇÂ∏∏ÈúÄÂ°´ÂÜôËÆæÂ§áÂêçÁß∞ÂíåËµÑ‰∫ßÁºñÁ†Å');\r\n        return;\r\n      }\r\n      query += `&deviceName=${encodeURIComponent(deviceName)}&assetCode=${encodeURIComponent(assetCode)}&type=ËÆæÂ§áÁ±ªÂºÇÂ∏∏`;\r\n      bgColor = '#FFF9C4';\r\n    } else {\r\n      query += `&type=Âà∂Á®ãÁ±ªÂºÇÂ∏∏`;\r\n    }\r\n\r\n    const { generateQRCanvas } = await import('./qrgen.js');\r\n    const canvas = generateQRCanvas(query, bgColor);\r\n    const container = document.getElementById('qr-canvas-container');\r\n    container.innerHTML = '';\r\n    container.appendChild(canvas);\r\n    document.getElementById('qr-output').classList.remove('hidden');\r\n\r\n    document.getElementById('download-btn').onclick = () => {\r\n      canvas.toBlob(blob => {\r\n        const a = document.createElement('a');\r\n        a.href = URL.createObjectURL(blob);\r\n        a.download = 'ÂºÇÂ∏∏‰∫åÁª¥Á†Å.png';\r\n        a.click();\r\n      }, 'image/png');\r\n    };\r\n  };\r\n}\r\n\r\nasync function bindMQTTConfigEvents() {\r\n  document.getElementById('unlock-btn').onclick = async () => {\r\n    const pwd = document.getElementById('config-pwd').value;\r\n    if (pwd === 'shokz@2025') {\r\n      document.getElementById('password-prompt').classList.add('hidden');\r\n      document.getElementById('config-form').classList.remove('hidden');\r\n\r\n      const { getConfig } = await import('./db.js');\r\n      const config = await getConfig();\r\n      if (config) {\r\n        document.getElementById('host-url').value = config.hostUrl || 'wss://mqtt-broker.shokz.com.cn:8084/mqtt';\r\n        document.getElementById('username').value = config.username || '';\r\n        document.getElementById('password').value = config.password || '';\r\n        document.getElementById('clientId').value = config.clientId || '';\r\n        document.getElementById('topic').value = config.topic || '';\r\n      }\r\n    } else {\r\n      alert('ÂØÜÁ†ÅÈîôËØØ');\r\n    }\r\n  };\r\n\r\n  document.getElementById('test-btn').onclick = async () => {\r\n    const hostUrl = document.getElementById('host-url').value;\r\n    const username = document.getElementById('username').value;\r\n    const password = document.getElementById('password').value;\r\n    const clientId = document.getElementById('clientId').value;\r\n    if (!hostUrl || !username || !password || !clientId) {\r\n      alert('ËØ∑Â°´ÂÜôÂÆåÊï¥ÈÖçÁΩÆ');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const client = new Paho.MQTT.Client(\r\n        hostUrl.replace('wss://', '').split(':')[0],\r\n        parseInt(hostUrl.split(':')[2]),\r\n        hostUrl.split('/')[3] || 'mqtt',\r\n        clientId\r\n      );\r\n      await new Promise((resolve, reject) => {\r\n        client.connect({\r\n          useSSL: true,\r\n          userName: username,\r\n          password: password,\r\n          onSuccess: () => {\r\n            client.disconnect();\r\n            resolve();\r\n          },\r\n          onFailure: (e) => reject(e),\r\n          timeout: 5\r\n        });\r\n      });\r\n      alert('‚úÖ ËøûÊé•ÊàêÂäü');\r\n    } catch (err) {\r\n      let msg = '‚ùå ËøûÊé•Â§±Ë¥•';\r\n      if (err.errorCode === 4) msg = '‚ùå ËÆ§ËØÅÂ§±Ë¥•';\r\n      else if (err.errorMessage?.includes('timeout')) msg = '‚è±Ô∏è ËøûÊé•Ë∂ÖÊó∂';\r\n      else msg = 'üåê ÁΩëÁªú‰∏çÂèØËææ';\r\n      alert(msg);\r\n    }\r\n  };\r\n\r\n  document.getElementById('save-btn').onclick = async () => {\r\n    const config = {\r\n      hostUrl: document.getElementById('host-url').value,\r\n      username: document.getElementById('username').value,\r\n      password: document.getElementById('password').value,\r\n      clientId: document.getElementById('clientId').value,\r\n      topic: document.getElementById('topic').value\r\n    };\r\n    const { saveConfig } = await import('./db.js');\r\n    await saveConfig(config);\r\n    alert('‚úÖ ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò');\r\n  };\r\n}\r\n\r\nasync function bindFormEvents() {\r\n  document.getElementById('submit-btn').onclick = async () => {\r\n    const reporter = document.getElementById('reporter').value.trim();\r\n    const desc = document.getElementById('desc').value.trim();\r\n    if (!reporter || !desc) {\r\n      alert('ËØ∑Â°´ÂÜôÊèêÊä•‰∫∫ÂíåÂºÇÂ∏∏ÊèèËø∞');\r\n      return;\r\n    }\r\n\r\n    const isDevice = currentParams.type === 'ËÆæÂ§áÁ±ªÂºÇÂ∏∏';\r\n    const data = {\r\n      product: currentParams.product,\r\n      line: currentParams.line,\r\n      workstation: currentParams.station,\r\n      deviceName: isDevice ? (currentParams.deviceName || '') : '',\r\n      assetCode: isDevice ? (currentParams.assetCode || '') : '',\r\n      exception_type: currentParams.type,\r\n      exception_description: desc,\r\n      yieldRate: !isDevice ? (document.getElementById(\"yield\")?.value.trim() || \"\") : \"\",\r\n      temporaryMeasure: !isDevice ? (document.getElementById(\"measure\")?.value.trim() || \"\") : \"\"\r\n    };\r\n\r\n    try {\r\n      await import('./mqtt.js').then(m => m.publishMessage({\r\n        header: {},\r\n        body: {\r\n          things: [{\r\n            id: \"\",\r\n            items: [{\r\n              quality: {},\r\n              properties: data\r\n            }]\r\n          }]\r\n        }\r\n      }));\r\n      alert('‚úÖ Êèê‰∫§ÊàêÂäü');\r\n      window.currentParams = null;\r\n      setTimeout(() => location.hash = '/', 3000);\r\n    } catch (err) {\r\n      try {\r\n        await import('./db.js').then(m => m.saveDraft({ formData: { ...data, reporter } }));\r\n        alert('‚ö†Ô∏è Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñ MQTT ÈÖçÁΩÆ\\nÔºàÂ∑≤‰øùÂ≠òËçâÁ®øÔºâ');\r\n      } catch (e) {\r\n        alert('Êèê‰∫§Â§±Ë¥•‰∏îËçâÁ®ø‰øùÂ≠òÂºÇÂ∏∏');\r\n      }\r\n    }\r\n  };\r\n}"],"file":"assets/main-C_Fs-QWU.js"}
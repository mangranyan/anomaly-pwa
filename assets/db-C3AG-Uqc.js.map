{"version":3,"file":"db-C3AG-Uqc.js","sources":["../../db.js"],"sourcesContent":["// https://cdn.jsdelivr.net/npm/idb@8/+esm\r\nconst DB_NAME = 'AbnormalReportDB';\r\n\r\nexport const openDB = async () => {\r\n  return new Promise((resolve, reject) => {\r\n    const req = indexedDB.open(DB_NAME, 1);\r\n    req.onerror = () => reject(req.error);\r\n    req.onupgradeneeded = (e) => {\r\n      const db = e.target.result;\r\n      if (!db.objectStoreNames.contains('drafts')) {\r\n        db.createObjectStore('drafts', { keyPath: 'id' });\r\n      }\r\n      if (!db.objectStoreNames.contains('config')) {\r\n        db.createObjectStore('config', { keyPath: 'key' });\r\n      }\r\n    };\r\n    req.onsuccess = () => resolve(req.result);\r\n  });\r\n};\r\n\r\nexport const saveDraft = async (draft) => {\r\n  const db = await openDB();\r\n  const tx = db.transaction('drafts', 'readwrite');\r\n  draft.id = 'current';\r\n  draft.timestamp = new Date().toISOString();\r\n  tx.objectStore('drafts').put(draft);\r\n  await tx.done;\r\n};\r\n\r\nexport const getDraft = async () => {\r\n  const db = await openDB();\r\n  const tx = db.transaction('drafts', 'readonly');\r\n  const draft = await tx.objectStore('drafts').get('current');\r\n  await tx.done;\r\n  return draft;\r\n};\r\n\r\nexport const deleteDraft = async () => {\r\n  const db = await openDB();\r\n  const tx = db.transaction('drafts', 'readwrite');\r\n  tx.objectStore('drafts').delete('current');\r\n  await tx.done;\r\n};\r\n\r\nexport const saveConfig = async (config) => {\r\n  const db = await openDB();\r\n  const tx = db.transaction('config', 'readwrite');\r\n  await tx.objectStore('config').put({ key: 'mqtt', ...config });\r\n  await tx.done;\r\n};\r\n\r\nexport const getConfig = async () => {\r\n  const db = await openDB();\r\n  const tx = db.transaction('config', 'readonly');\r\n  const config = await tx.objectStore('config').get('mqtt');\r\n  await tx.done;\r\n  return config;\r\n};"],"names":["DB_NAME","openDB","resolve","reject","req","e","db","saveDraft","draft","tx","getDraft","deleteDraft","saveConfig","config","getConfig"],"mappings":"AACA,MAAMA,EAAU,mBAEHC,EAAS,SACb,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMC,EAAM,UAAU,KAAKJ,EAAS,CAAC,EACrCI,EAAI,QAAU,IAAMD,EAAOC,EAAI,KAAK,EACpCA,EAAI,gBAAmBC,GAAM,CAC3B,MAAMC,EAAKD,EAAE,OAAO,OACfC,EAAG,iBAAiB,SAAS,QAAQ,GACxCA,EAAG,kBAAkB,SAAU,CAAE,QAAS,IAAI,CAAE,EAE7CA,EAAG,iBAAiB,SAAS,QAAQ,GACxCA,EAAG,kBAAkB,SAAU,CAAE,QAAS,KAAK,CAAE,CAErD,EACAF,EAAI,UAAY,IAAMF,EAAQE,EAAI,MAAM,CAC1C,CAAC,EAGUG,EAAY,MAAOC,GAAU,CAExC,MAAMC,GADK,MAAMR,KACH,YAAY,SAAU,WAAW,EAC/CO,EAAM,GAAK,UACXA,EAAM,UAAY,IAAI,KAAI,EAAG,YAAW,EACxCC,EAAG,YAAY,QAAQ,EAAE,IAAID,CAAK,EAClC,MAAMC,EAAG,IACX,EAEaC,EAAW,SAAY,CAElC,MAAMD,GADK,MAAMR,KACH,YAAY,SAAU,UAAU,EACxCO,EAAQ,MAAMC,EAAG,YAAY,QAAQ,EAAE,IAAI,SAAS,EAC1D,aAAMA,EAAG,KACFD,CACT,EAEaG,EAAc,SAAY,CAErC,MAAMF,GADK,MAAMR,KACH,YAAY,SAAU,WAAW,EAC/CQ,EAAG,YAAY,QAAQ,EAAE,OAAO,SAAS,EACzC,MAAMA,EAAG,IACX,EAEaG,EAAa,MAAOC,GAAW,CAE1C,MAAMJ,GADK,MAAMR,KACH,YAAY,SAAU,WAAW,EAC/C,MAAMQ,EAAG,YAAY,QAAQ,EAAE,IAAI,CAAE,IAAK,OAAQ,GAAGI,CAAM,CAAE,EAC7D,MAAMJ,EAAG,IACX,EAEaK,EAAY,SAAY,CAEnC,MAAML,GADK,MAAMR,KACH,YAAY,SAAU,UAAU,EACxCY,EAAS,MAAMJ,EAAG,YAAY,QAAQ,EAAE,IAAI,MAAM,EACxD,aAAMA,EAAG,KACFI,CACT"}
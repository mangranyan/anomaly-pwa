{"version":3,"mappings":"uCAAA,IAAIA,EAAS,KACTC,EAAkB,KAEV,MAACC,EAAiB,MAAOC,GAAY,CAC/C,MAAMC,EAAS,MAAKC,EAAA,IAAC,OAAO,kBAAS,MAAE,KAAKC,GAAKA,EAAE,UAAS,CAAE,EAC9D,GAAI,CAACF,EAAQ,MAAM,IAAI,MAAM,WAAW,EAExC,KAAM,CAAE,KAAAG,EAAM,KAAAC,EAAM,SAAAC,EAAU,SAAAC,EAAU,SAAAC,EAAU,MAAAC,CAAK,EAAKR,EAE5D,GAAI,CAACJ,GAAUA,EAAO,aACpB,OAAAA,EAAS,IAAI,KAAK,KAAK,OAAOO,EAAM,SAASC,EAAK,MAAM,GAAG,EAAE,CAAC,CAAC,EAAGA,EAAK,MAAM,GAAG,EAAE,CAAC,EAAGG,CAAQ,EAEvF,IAAI,QAAQ,CAACE,EAASC,IAAW,CACtCd,EAAO,QAAQ,CACb,OAAQ,GACR,SAAUS,EACV,SAAUC,EACV,UAAW,IAAM,CACf,MAAMK,EAAU,IAAI,KAAK,KAAK,QAAQ,KAAK,UAAUZ,CAAO,CAAC,EAC7DY,EAAQ,gBAAkBH,EAC1BG,EAAQ,IAAM,EACdf,EAAO,KAAKe,CAAO,EACnBF,IAEA,aAAaZ,CAAe,EAC5BA,EAAkB,WAAW,IAAMD,EAAO,WAAU,EAAI,GAAK,CAC/D,EACA,UAAYgB,GAAQF,EAAO,IAAI,MAAM,UAAU,CAAC,EAChD,QAAS,CACjB,CAAO,CACH,CAAC,EACI,CACL,MAAMC,EAAU,IAAI,KAAK,KAAK,QAAQ,KAAK,UAAUZ,CAAO,CAAC,EAC7DY,EAAQ,gBAAkBH,EAC1BG,EAAQ,IAAM,EACdf,EAAO,KAAKe,CAAO,EACnB,aAAad,CAAe,EAC5BA,EAAkB,WAAW,IAAMD,EAAO,WAAU,EAAI,GAAK,CAC/D,CACF,EAGMiB,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,IAAM,0EACb,SAAS,KAAK,YAAYA,CAAM","names":["client","disconnectTimer","publishMessage","message","config","__vitePreload","m","host","path","username","password","clientId","topic","resolve","reject","payload","err","script"],"ignoreList":[],"sources":["../../mqtt.js"],"sourcesContent":["let client = null;\r\nlet disconnectTimer = null;\r\n\r\nexport const publishMessage = async (message) => {\r\n  const config = await import('./db.js').then(m => m.getConfig());\r\n  if (!config) throw new Error('MQTT配置未设置');\r\n\r\n  const { host, path, username, password, clientId, topic } = config;\r\n\r\n  if (!client || client.disconnected) {\r\n    client = new Paho.MQTT.Client(host, parseInt(path.split(':')[1]), path.split('/')[1], clientId);\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      client.connect({\r\n        useSSL: true,\r\n        userName: username,\r\n        password: password,\r\n        onSuccess: () => {\r\n          const payload = new Paho.MQTT.Message(JSON.stringify(message));\r\n          payload.destinationName = topic;\r\n          payload.qos = 1;\r\n          client.send(payload);\r\n          resolve();\r\n          // Auto disconnect after 10s\r\n          clearTimeout(disconnectTimer);\r\n          disconnectTimer = setTimeout(() => client.disconnect(), 10000);\r\n        },\r\n        onFailure: (err) => reject(new Error('MQTT连接失败')),\r\n        timeout: 5\r\n      });\r\n    });\r\n  } else {\r\n    const payload = new Paho.MQTT.Message(JSON.stringify(message));\r\n    payload.destinationName = topic;\r\n    payload.qos = 1;\r\n    client.send(payload);\r\n    clearTimeout(disconnectTimer);\r\n    disconnectTimer = setTimeout(() => client.disconnect(), 10000);\r\n  }\r\n};\r\n\r\n// Load Paho MQTT\r\nconst script = document.createElement('script');\r\nscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js';\r\ndocument.head.appendChild(script);"],"file":"assets/mqtt-CZyA_xVM.js"}
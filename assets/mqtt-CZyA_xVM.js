import{_ as T}from"./main-C_Fs-QWU.js";let e=null,o=null;const w=async s=>{const i=await T(()=>import("./db-C3AG-Uqc.js"),[]).then(t=>t.getConfig());if(!i)throw new Error("MQTT配置未设置");const{host:l,path:a,username:d,password:m,clientId:p,topic:r}=i;if(!e||e.disconnected)return e=new Paho.MQTT.Client(l,parseInt(a.split(":")[1]),a.split("/")[1],p),new Promise((t,u)=>{e.connect({useSSL:!0,userName:d,password:m,onSuccess:()=>{const n=new Paho.MQTT.Message(JSON.stringify(s));n.destinationName=r,n.qos=1,e.send(n),t(),clearTimeout(o),o=setTimeout(()=>e.disconnect(),1e4)},onFailure:n=>u(new Error("MQTT连接失败")),timeout:5})});{const t=new Paho.MQTT.Message(JSON.stringify(s));t.destinationName=r,t.qos=1,e.send(t),clearTimeout(o),o=setTimeout(()=>e.disconnect(),1e4)}},c=document.createElement("script");c.src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js";document.head.appendChild(c);export{w as publishMessage};
//# sourceMappingURL=mqtt-CZyA_xVM.js.map
